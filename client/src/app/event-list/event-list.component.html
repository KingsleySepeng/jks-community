<div class="event-list-container">
  <h2>Upcoming Events</h2>

  <div *ngFor="let evt of events" class="event-item">
    <h3>{{ evt.eventName }} ({{ evt.location }})</h3>
    <p><strong>Date:</strong> {{ evt.date | date }}</p>
    <p><strong>Cost:</strong> {{ evt.cost | currency }}</p>
    <p><strong>Payment Due:</strong> {{ evt.paymentDueDate | date }}</p>
    <p><strong>Instructor:</strong> {{ getInstructorName(evt.instructorId) }}</p>
    <p><strong>Club:</strong> {{ getClubName(evt.clubId) }}</p>
    <p><strong>Description:</strong> {{ evt.description }}</p>
    <p><strong>Availability:</strong> {{ getRemainingSpots(evt) }}</p>

    <p *ngIf="isInstructor && evt.instructorId === loggedInUser?.id">
      <strong>Registrations:</strong> {{ getRegistrationsCount(evt.id) }}
    </p>
    <p *ngIf="isInstructor && evt.instructorId === loggedInUser?.id">
      <strong>Payments:</strong> {{ getPaymentsCount(evt.id) }}
    </p>

    <div *ngIf="isInstructor && evt.instructorId === loggedInUser?.id">
      <h4>Participants</h4>
      <table>
        <thead>
        <tr>
          <th>Name</th>
          <th>Surname</th>
          <th>Club</th>
          <th>Registration Date</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let participant of getParticipants(evt.id)">
          <td>{{ participant.name }}</td>
          <td>{{ participant.surname }}</td>
          <td>{{ participant.club }}</td>
          <td>{{ participant.date | date }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <button *ngIf="!isInstructor && !isEventDatePassed(evt)" (click)="onStudentInterest(evt)">
      I'm Interested
    </button>
    <button *ngIf="isInstructor && !isEventDatePassed(evt)" (click)="onOpenFinalizeRegistration(evt)">
      Finalize Registration
    </button>
    <p *ngIf="isEventDatePassed(evt)" class="event-closed">Registration Closed</p>

    <hr />
  </div>
</div>

<div *ngIf="selectedEvent" class="finalize-registration">
  <h2>Finalize Registration for {{ selectedEvent.eventName }}</h2>
  <p>Select students from your club to register for this event:</p>

  <ul>
    <li *ngFor="let student of clubStudents">
      <label>
        <input
          type="checkbox"
          [checked]="selectedStudents.has(student.id)"
          (change)="toggleStudentSelection(student.id)"
        />
        {{ student.firstName }} {{ student.lastName }}
      </label>
    </li>
  </ul>

  <button (click)="onConfirmFinalRegistration()">Confirm Registration</button>
  <button (click)="onCancelFinalRegistration()">Cancel</button>
</div>
